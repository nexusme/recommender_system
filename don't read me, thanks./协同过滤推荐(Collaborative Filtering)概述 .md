# 协同过滤推荐(Collaborative Filtering) 
### 1. 概述 

协同过滤(Collaborative Filtering)作为推荐算法中最经典的类型，包括**在线协同**和**离线过滤**两部分。所谓在线协同，就是通过在线数据找到用户可能喜欢的物品，而离线过滤，则是过滤掉一些不值得推荐的数据，比比如推荐值评分低的数据，或者虽然推荐值高但是用户已经购买的数据。

协同过滤的模型一般为m个物品，m个用户的数据，只有部分用户和部分数据之间是有评分数据的，其它部分评分是空白，此时我们要用**已有的部分稀疏数据**来预测那些**空白的物品和数据之间的评分关系**，找到最高评分的物品推荐给用户。

### 2. 类型
一般来说，协同过滤推荐分为三种类型。第一种是**基于用户(user-based)**的协同过滤，第二种是**基于项目(item-based)**的协同过滤，第三种是**基于模型(model based)**的协同过滤。

#### 2a. 基于用户(user-based)的协同过滤  
主要考虑的是用户和用户之间的**相似度**，只要找出**相似用户喜欢**的物品，并预测目标用户对对应物品的**评分**，就可以找到评分最高的若干个物品推荐给用户。

#### 2b. 基于项目(item-based)的协同过滤
与基于用户的协同过滤类似，只不过这时我们转向找到**物品和物品**之间的相似度，只有找到了目标用户对某些物品的评分，那么我们就可以对相似度高的类似物品进行预测，将评分最高的若干个相似物品推荐给用户。比如你在网上买了一本机器学习相关的书，网站马上会推荐一堆机器学习，大数据相关的书给你，这里就明显用到了基于项目的协同过滤思想。

#### 2c. 基于模型(model based)的协同过滤
是目前最主流的协同过滤类型了，我们的一大堆机器学习算法也可以在这里找到用武之地。下面我们就重点介绍基于模型的协同过滤。

### 3. 类型比较
基于用户的协同过滤需要在线找用户和用户之间的相似度关系，计算复杂度肯定会比基于基于项目的协同过滤高。但是可以帮助用户找到新类别的有惊喜的物品。  

基于项目的协同过滤，由于考虑的物品的相似性一段时间不会改变，因此可以很容易的离线计算，准确度一般也可以接受，但是推荐的多样性来说，就很难带给用户惊喜了。  

一般对于**小型**的推荐系统来说，**基于项目**的协同过滤肯定是主流。但是如果是**大型**的推荐系统来说，则可以考虑**基于用户的协同过滤**，当然更加可以考虑我们的第三种类型，基于模型的协同过滤。

### 4. 主要展开：基于模型（model based) 的协同过滤

####4.a 简单介绍
基于模型的协同过滤作为目前最主流的协同过滤类型，这里主要是对其思想做有一个归类概括。我们的问题是这样的m个物品，m个用户的数据，只有部分用户和部分数据之间是有评分数据的，其它部分评分是空白，此时我们要用已有的部分稀疏数据来预测那些空白的物品和数据之间的评分关系，找到最高评分的物品推荐给用户。

对于这个问题，用机器学习的思想来建模解决，主流的方法可以分为：**用关联算法**，**聚类算法**，**分类算法**，**回归算法**，**矩阵分解**，**神经网络**, **图模型**以及**隐语义模型**来解决。下面我们分别加以介绍。

####4.b 用关联算法做协同过滤
一般我们可以找出用户购买的所有物品数据里频繁出现的项集合序列，来做频繁集挖掘，找到满足支持度阈值的关联物品的频繁N项集或者序列。如果用户购买了频繁N项集或者序列里的部分物品，那么我们可以将频繁项集或序列里的其他物品按一定的评分准则推荐给用户，这个评分准则可以包括支持度，置信度和提升度等。

常用的关联推荐算法有Apriori，FP Tree和PrefixSpan  

[Apriori算法原理总结
](https://www.cnblogs.com/pinard/p/6293298.html)  

[FP Tree算法原理总结
](https://www.cnblogs.com/pinard/p/6307064.html)  

[PrefixSpan算法原理总结](https://www.cnblogs.com/pinard/p/6323182.html)

####4.c 用聚类算法做协同过滤

用聚类算法做协同过滤就和前面的基于用户或者项目的协同过滤有些类似了。我们可以按照用户或者按照物品基于一定的距离度量来进行聚类。如果基于用户聚类，则可以将用户按照一定距离度量方式分成不同的目标人群，将同样目标人群评分高的物品推荐给目标用户。基于物品聚类的话，则是将用户评分高物品的相似同类物品推荐给用户。  

常用的聚类推荐算法有K-Means, BIRCH, DBSCAN和谱聚类

[K-Means聚类算法原理
](https://www.cnblogs.com/pinard/p/6164214.html)

[BIRCH聚类算法原理
](https://www.cnblogs.com/pinard/p/6179132.html)

[DBSCAN密度聚类算法
](https://www.cnblogs.com/pinard/p/6208966.html)

[谱聚类（spectral clustering）原理总结
](https://www.cnblogs.com/pinard/p/6221564.html)

####4.d 用分类算法做协同过滤

如果我们根据用户评分的高低，将分数分成几段的话，则这个问题变成分类问题。

比如最直接的，设置一份评分阈值，评分高于阈值的就是推荐，评分低于阈值就是不推荐，我们将问题变成了一个二分类问题。虽然分类问题的算法多如牛毛，但是目前使用最广泛的是逻辑回归。  

逻辑回归的解释性比较强，每个物品是否推荐我们都有一个明确的概率放在这，同时可以对数据的特征做工程化，得到调优的目的。

常见的分类推荐算法有逻辑回归和朴素贝叶斯，两者的特点是解释性很强。  

[逻辑回归原理小结
](https://www.cnblogs.com/pinard/p/6029432.html)

[朴素贝叶斯算法原理小结
](https://www.cnblogs.com/pinard/p/6069267.html)

####4.e 用回归算法做协同过滤

用回归算法做协同过滤比分类算法看起来更加的自然。我们的评分可以是一个连续的值而不是离散的值，通过回归模型我们可以得到目标用户对某商品的预测打分。

常用的回归推荐算法有Ridge回归，回归树和支持向量回归。  

[线性回归原理小结
](https://www.cnblogs.com/pinard/p/6004041.html)

[决策树算法原理(下)
](https://www.cnblogs.com/pinard/p/6053344.html)

[支持向量机原理(五)线性支持回归
](https://www.cnblogs.com/pinard/p/6113120.html)

####4.e 用矩阵分解做协同过滤
用矩阵分解做协同过滤是目前使用也很广泛的一种方法。由于传统的奇异值分解SVD要求矩阵不能有缺失数据，必须是稠密的，而我们的用户物品评分矩阵是一个很典型的稀疏矩阵，直接使用传统的SVD到协同过滤是比较复杂的。

目前主流的矩阵分解推荐算法主要是SVD的一些变种，比如FunkSVD，BiasSVD和SVD++。这些算法和传统SVD的最大区别是不再要求将矩阵分解为UΣVTUΣVT的形式，而变是两个低秩矩阵PTQPTQ的乘积形式。对于矩阵分解的推荐算法，后续我会专门开篇来讲。

####4.e 用神经网络做协同过滤

用神经网络乃至深度学习做协同过滤应该是以后的一个趋势。目前比较主流的用两层神经网络来做推荐算法的是限制玻尔兹曼机(RBM)。

####4.e 用图模型做协同过
用图模型做协同过滤，则将用户之间的相似度放到了一个图模型里面去考虑，常用的算法SimRank系列算法和马尔科夫模型算法。对于SimRank系列算法，它的基本思想是被相似对象引用的两个对象也具有相似性。算法思想有点类似于大名鼎鼎的PageRank。而马尔科夫模型算法当然是基于马尔科夫链了，它的基本思想是基于传导性来找出普通距离度量算法难以找出的相似性。后续我会专门开篇来讲讲SimRank系列算法。　

####4.e 用隐语义模型做协同过滤

隐语义模型主要是基于NLP的，涉及到对用户行为的语义分析来做评分推荐，主要方法有隐性语义分析LSA和隐含狄利克雷分布LDA。


### 5 协同过滤总结　

协同过滤作为一种经典的推荐算法种类，在工业界应用广泛，它的优点很多，模型通用性强，不需要太多对应数据领域的专业知识，工程实现简单，效果也不错。这些都是它流行的原因。

协同过滤也有些难以避免的难题，比如令人头疼的“冷启动”问题，我们没有新用户任何数据的时候，无法较好的为新用户推荐物品。同时也没有考虑情景的差异，比如根据用户所在的场景和用户当前的情绪。当然，也无法得到一些小众的独特喜好，这块是基于内容的推荐比较擅长的。　

![](https://picb.zhimg.com/v2-a52d5bac603005befad8ed9950c9f36c_r.jpg?source=1940ef5c)